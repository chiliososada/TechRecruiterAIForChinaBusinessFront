-- 1. 项目表
CREATE TABLE public.projects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  client_company text,
  partner_company text,
  description text,
  detail_description text,
  status text DEFAULT '募集中'::text,
  priority text DEFAULT '中'::text,
  manager_name text,
  manager_email text,
  skills text[] DEFAULT '{}'::text[],
  experience text,
  key_technologies text,
  location text,
  budget text,
  desired_budget text,
  work_type text,
  duration text,
  start_date date,
  application_deadline date,
  japanese_level text,
  processes text[] DEFAULT '{}'::text[],
  interview_count text DEFAULT '1'::text,
  max_candidates integer DEFAULT 5,
  foreigner_accepted boolean DEFAULT false,
  freelancer_accepted boolean DEFAULT false,
  company_type text NOT NULL DEFAULT '自社'::text,
  source text DEFAULT 'manual_entry'::text,
  source_document_url text,
  ai_processed boolean DEFAULT false,
  ai_extracted_project_data jsonb DEFAULT '{}'::jsonb,
  ai_match_embedding vector,
  ai_match_paraphrase text,
  primary_manager_id uuid,
  received_date timestamptz,
  is_active boolean DEFAULT true,
  tenant_id uuid NOT NULL,
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  registered_at timestamptz DEFAULT now(),
  PRIMARY KEY (id)
);

-- 2. 工程师表
CREATE TABLE public.engineers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  email text,
  phone text,
  gender text,
  age text,
  nationality text,
  nearest_station text,
  education text,
  arrival_year_japan text,
  certifications text[] DEFAULT '{}'::text[],
  skills text[] DEFAULT '{}'::text[],
  technical_keywords text[] DEFAULT '{}'::text[],
  experience text NOT NULL,
  work_scope text,
  work_experience text,
  japanese_level text,
  english_level text,
  availability text,
  current_status text DEFAULT 'available'::text,
  company_type text NOT NULL,
  company_name text,
  preferred_work_style text[] DEFAULT '{}'::text[],
  preferred_locations text[] DEFAULT '{}'::text[],
  self_promotion text,
  remarks text,
  recommendation text,
  resume_url text,
  resume_text text,
  source text,
  source_details text,
  skills_detail jsonb DEFAULT '{}'::jsonb,
  project_history jsonb DEFAULT '{}'::jsonb,
  desired_rate_min integer,
  desired_rate_max integer,
  overtime_available boolean DEFAULT false,
  business_trip_available boolean DEFAULT false,
  documents jsonb DEFAULT '{}'::jsonb,
  ai_extracted_data jsonb DEFAULT '{}'::jsonb,
  ai_match_embedding vector,
  ai_match_paraphrase text,
  evaluations jsonb DEFAULT '{}'::jsonb,
  last_active_at timestamptz,
  profile_completion_rate numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  tenant_id uuid NOT NULL,
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  deleted_at timestamptz,
  PRIMARY KEY (id)
);

-- 3. 项目工程师匹配表
CREATE TABLE public.project_engineer_matches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid NOT NULL,
  engineer_id uuid NOT NULL,
  tenant_id uuid NOT NULL,
  matching_history_id uuid,
  match_score numeric,
  confidence_score numeric,
  skill_match_score numeric,
  project_experience_match_score numeric,
  experience_match_score numeric,
  japanese_level_match_score numeric,
  budget_match_score numeric,
  location_match_score numeric,
  matched_skills text[] DEFAULT '{}'::text[],
  missing_skills text[] DEFAULT '{}'::text[],
  project_experience_match text[] DEFAULT '{}'::text[],
  missing_project_experience text[] DEFAULT '{}'::text[],
  matched_experiences text[] DEFAULT '{}'::text[],
  missing_experiences text[] DEFAULT '{}'::text[],
  match_reasons text[] DEFAULT '{}'::text[],
  concerns text[] DEFAULT '{}'::text[],
  comment text,
  status text DEFAULT '未保存'::text,
  reviewed_by uuid,
  reviewed_at timestamptz,
  ai_match_data jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  deleted_at timestamptz,
  PRIMARY KEY (id)
);

-- 4. 项目归档表
CREATE TABLE public.project_archives (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  original_project_id uuid NOT NULL,
  project_data jsonb NOT NULL,
  archive_reason text,
  archived_by uuid,
  archived_at timestamptz DEFAULT now(),
  tenant_id uuid NOT NULL,
  PRIMARY KEY (id)
);

-- 5. 邮件发送队列表
CREATE TABLE public.email_sending_queue (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  to_emails text[] NOT NULL,
  cc_emails text[] DEFAULT '{}'::text[],
  bcc_emails text[] DEFAULT '{}'::text[],
  subject text NOT NULL,
  body_html text,
  body_text text,
  attachments jsonb DEFAULT '{}'::jsonb,
  template_id uuid,
  smtp_setting_id uuid,
  status text DEFAULT 'queued'::text,
  priority integer DEFAULT 5,
  scheduled_at timestamptz DEFAULT now(),
  sent_at timestamptz,
  current_retry_count integer DEFAULT 0,
  max_retry_count integer DEFAULT 3,
  last_attempt_at timestamptz,
  error_message text,
  send_duration_ms integer,
  email_metadata jsonb DEFAULT '{}'::jsonb,
  related_project_id uuid,
  related_engineer_id uuid,
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  PRIMARY KEY (id)
);

-- 6. SMTP设置表
CREATE TABLE public.email_smtp_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  setting_name text NOT NULL,
  smtp_host text NOT NULL,
  smtp_port integer NOT NULL DEFAULT 587,
  smtp_username text NOT NULL,
  smtp_password_encrypted text NOT NULL,
  security_protocol text DEFAULT 'TLS'::text,
  from_email text NOT NULL,
  from_name text,
  reply_to_email text,
  is_default boolean DEFAULT false,
  is_active boolean DEFAULT true,
  connection_status text DEFAULT 'untested'::text,
  last_test_at timestamptz,
  last_test_error text,
  daily_send_limit integer DEFAULT 1000,
  hourly_send_limit integer DEFAULT 100,
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  deleted_at timestamptz,
  PRIMARY KEY (id)
);

-- 7. 邮件模板表
CREATE TABLE public.email_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  name text NOT NULL,
  description text,
  category text,
  subject_template text NOT NULL,
  body_template_text text NOT NULL,
  body_template_html text,
  available_placeholders text[] DEFAULT '{}'::text[],
  required_placeholders text[] DEFAULT '{}'::text[],
  ai_summary_enabled boolean DEFAULT false,
  is_active boolean DEFAULT true,
  usage_count integer DEFAULT 0,
  last_used_at timestamptz,
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  deleted_at timestamptz,
  PRIMARY KEY (id)
);

-- 8. 接收邮件表
CREATE TABLE public.receive_emails (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  sender_name text,
  sender_email text,
  sender_company text,
  subject text,
  body_html text,
  body_text text,
  raw_email text,
  attachments jsonb DEFAULT '{}'::jsonb,
  recipient_to text[] DEFAULT '{}'::text[],
  recipient_cc text[] DEFAULT '{}'::text[],
  recipient_bcc text[] DEFAULT '{}'::text[],
  received_at timestamptz DEFAULT now(),
  email_type text,
  processing_status text DEFAULT 'pending'::text,
  ai_extraction_status text DEFAULT 'pending'::text,
  processing_attempts integer DEFAULT 0,
  processing_error text,
  project_id uuid,
  engineer_id uuid,
  project_sender_id uuid,
  engineer_sender_id uuid,
  ai_extracted_data jsonb DEFAULT '{}'::jsonb,
  created_at timestamptz DEFAULT now(),
  PRIMARY KEY (id)
);

-- 9. 统计汇总表
CREATE TABLE public.statistics_summary (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  summary_date date NOT NULL,
  summary_type text NOT NULL,
  total_projects_count integer DEFAULT 0,
  active_projects_count integer DEFAULT 0,
  completed_projects_count integer DEFAULT 0,
  new_projects_count integer DEFAULT 0,
  project_fill_rate numeric,
  avg_time_to_fill_project_days numeric,
  total_engineers_count integer DEFAULT 0,
  active_engineers_count integer DEFAULT 0,
  new_engineers_count integer DEFAULT 0,
  engineer_placement_rate numeric,
  matches_generated_count integer DEFAULT 0,
  high_quality_matches_count integer DEFAULT 0,
  successful_placements_count integer DEFAULT 0,
  match_success_rate numeric,
  emails_sent_count integer DEFAULT 0,
  emails_opened_rate numeric,
  emails_clicked_rate numeric,
  ai_insights jsonb DEFAULT '{}'::jsonb,
  additional_metrics jsonb DEFAULT '{}'::jsonb,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  PRIMARY KEY (id)
);

-- 10. AI配置表
CREATE TABLE public.user_ai_configurations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  user_id uuid,
  provider_id uuid NOT NULL,
  config_name text NOT NULL,
  description text,
  api_key_encrypted text,
  api_secret_encrypted text,
  organization_id text,
  api_base_url text,
  api_version text,
  default_model text,
  available_models text[] DEFAULT '{}'::text[],
  default_temperature numeric DEFAULT 0.7,
  default_max_tokens integer DEFAULT 1000,
  default_top_p numeric DEFAULT 1.0,
  custom_parameters jsonb DEFAULT '{}'::jsonb,
  is_default boolean DEFAULT false,
  is_active boolean DEFAULT true,
  connection_status text DEFAULT 'untested'::text,
  last_test_at timestamptz,
  last_test_error text,
  last_used_at timestamptz,
  cost_tracking_enabled boolean DEFAULT false,
  estimated_monthly_cost numeric DEFAULT 0,
  actual_monthly_cost numeric DEFAULT 0,
  cost_currency text DEFAULT 'USD'::text,
  daily_request_limit integer,
  monthly_request_limit integer,
  current_day_usage integer DEFAULT 0,
  current_month_usage integer DEFAULT 0,
  last_usage_reset_date date DEFAULT CURRENT_DATE,
  rate_limit_settings jsonb DEFAULT '{}'::jsonb,
  retry_settings jsonb DEFAULT '{"max_retries": 3, "retry_delay": 1}'::jsonb,
  timeout_seconds integer DEFAULT 30,
  allowed_functions text[] DEFAULT '{}'::text[],
  enabled_for_matching boolean DEFAULT true,
  enabled_for_email_generation boolean DEFAULT true,
  enabled_for_document_extraction boolean DEFAULT true,
  enabled_for_reporting boolean DEFAULT true,
  ip_whitelist text[] DEFAULT '{}'::text[],
  created_by uuid,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  deleted_at timestamptz,
  PRIMARY KEY (id)
);

-- 创建索引
CREATE INDEX idx_projects_tenant_id ON public.projects(tenant_id);
CREATE INDEX idx_projects_status ON public.projects(status);
CREATE INDEX idx_projects_company_type ON public.projects(company_type);
CREATE INDEX idx_engineers_tenant_id ON public.engineers(tenant_id);
CREATE INDEX idx_engineers_company_type ON public.engineers(company_type);
CREATE INDEX idx_engineers_current_status ON public.engineers(current_status);
CREATE INDEX idx_project_engineer_matches_project_id ON public.project_engineer_matches(project_id);
CREATE INDEX idx_project_engineer_matches_engineer_id ON public.project_engineer_matches(engineer_id);
CREATE INDEX idx_project_engineer_matches_tenant_id ON public.project_engineer_matches(tenant_id);
这是我的数据库表结构
之后所有代码中如果有文本的话都用日语